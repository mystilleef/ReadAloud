function e(e){e?(r("stop"),n("Stop reading")):t()}function t(){r("default"),n("Read aloud selected text")}function r(e){const t={path:`images/${e}.svg`};chrome.browserAction.setIcon(t)}function n(e){chrome.browserAction.setTitle({title:e})}t();const o=/[-_.,:;!?<>\/()â€”[\]{}]/gm,c=new class{constructor(){this.counter=0}increment(){this.counter+=1,this.checkSpeakingState()}decrement(){this.counter-=1,this.checkSpeakingState()}reset(){this.counter=0,this.updateText()}checkSpeakingState(){chrome.tts.isSpeaking(e=>{e?this.updateText():this.reset()})}updateText(){chrome.browserAction.setBadgeText({text:`${0===this.counter?"":this.counter}`})}},s={pitch:0,volume:1,rate:1.5,lang:"en-GB",enqueue:!0,onEvent:t=>{chrome.tts.isSpeaking(t=>e(t)),"error"===t.type?a(`Error: ${t.errorMessage}`):"end"===t.type&&c.decrement()}};function i(e,t=s){e.split(o).map(e=>e.trim()).filter(e=>e.length).forEach(e=>(function(e,t){chrome.tts.speak(e,t,()=>{chrome.runtime.lastError&&a(`Error: ${chrome.runtime.lastError.message}`)}),c.increment()})(e,t))}function a(e){u(),console.error(e)}function u(){chrome.tts.stop(),c.reset()}const m="read-aloud-selected-text";function h(){chrome.tabs.query({active:!0,currentWindow:!0},e=>{const t=e[0].id||-1;return t&&chrome.tabs.sendMessage(t,{query:"GET_SELECTION"}),!0})}chrome.commands.onCommand.addListener(function(e){e===m&&h()}),chrome.browserAction.onClicked.addListener(function(e){chrome.tts.isSpeaking(e=>{e?u():h()})}),chrome.runtime.onMessage.addListener(function(e,t,r){if(t.id!==chrome.runtime.id)return!0;"READ_SELECTION"===e.message&&i(e.selection);return!0});
